<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neumorphic Controller Interface</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .neumorphic-container {
      background-color: #f0f0f0;
      border-radius: 20px;
      box-shadow: 10px 10px 20px #d3d3d3, -10px -10px 20px #ffffff;
      padding: 20px;
      margin: 20px;
      display: flex;
      flex-wrap: wrap;
      flex-flow: row wrap;
      justify-content: start;
      align-items: top;
    }

    .menu {
      width: 100%;
      background-color: #f0f0f0;
      border-radius: 20px;
      box-shadow: 6px 6px 12px #d3d3d3, -6px -6px 12px #ffffff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px;
      margin-bottom: 20px;
    }

    .menu-item {
      font-size: 16px;
      font-weight: bold;
      color: #555;
      cursor: pointer;
      transition: color 0.3s;
    }

    .menu-item:hover {
      color: #007BFF;
    }

    .gauge-panel {
      width: 45%;
      margin: 10px;
      display: flex;
      flex-wrap: wrap;
      flex-direction: row;
      align-items: center;
      justify-content: space-evenly;
      background-color: #f0f0f0;
      border-radius: 20px;
      box-shadow: 6px 6px 12px #d3d3d3, -6px -6px 12px #ffffff;
      min-width: 230px;
    }
    
    .major-panel {
      width: 50%;
      margin: 10px;
      display: flex;
      flex-wrap: wrap;
      flex-direction: row;
      align-items: center;
      justify-content: space-evenly;
      background-color: #f0f0f0;
      border-radius: 20px;
      box-shadow: 6px 6px 12px #d3d3d3, -6px -6px 12px #ffffff;
      min-width: 400px;
    }
    
    .control-panel {
      width: 350px;
      height: 275px;
      margin: 25px;
      display: flex;
      flex-direction: column;
      align-items: left;
      background-color: #f0f0f0;
      border-radius: 20px;
      box-shadow: 6px 6px 12px #d3d3d3, -6px -6px 12px #ffffff;
      position: relative;
      min-width: 230px;
    }

    .neumorphic-control {
      width: 80%;
      height: 50px;
      background-color: #f0f0f0;
      border-radius: 10px;
      box-shadow: 6px 6px 12px #d3d3d3, -6px -6px 12px #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .slider-container {
      display: flex;
      align-items: center;
/*       margin-bottom: 20px; /* Increased spacing */ 
    }

    .neumorphic-slider {
      width: 150px;
      height: 20px; 
      border-radius: 10px;
      background-color: #f0f0f0;
      box-shadow: inset 6px 6px 12px #d3d3d3, inset -6px -6px 12px #ffffff;
      position: relative; 
      margin: 25px;
    }

    .slider-thumb {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #f0f0f0;
      box-shadow: 6px 6px 12px #d3d3d3, -6px -6px 12px #ffffff;
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }

    .setting-label {
      font-size: 16px;
      color: #555;
      margin-left: 20px;
      margin-right: 30px; /* Increased spacing */
    }

    .setting-value {
      font-size: 14px;
      color: #555;
    }

    .chart {
      width: 600px;
      height: 300px;
      margin: 30px;
      background-color: #f0f0f0;
      border-radius: 20px;
      box-shadow: 6px 6px 12px #d3d3d3, -6px -6px 12px #ffffff;
    }
    
    .gauge-container {
      align-items: center;
      float: left; 
      display: flex;
      flex-direction: column;
      margin: 10px; /* Margin between gauges */
      margin-top: 30px;
      width: 240px; /* Set a specific width for each gauge container */
      height: 250px;
    }

    canvas {
      border-radius: 50%;
      box-shadow: 5px 5px 10px #d3d3d3, -5px -5px 10px #ffffff;
      object-fit:contain;
    }

    .gauge-label {
      margin-top: 10px;
      text-align: center;
    }
    
    .neumorphic-switch-container {
      display: flex;
      align-items: center;
            margin-left: 20px;
    }

    .switch-text {
      font-size: 16px;
      margin-right: 10px;
    }
    
    .neumorphic-switch {
      width: 60px;
      margin: 20px;
      height: 30px;
      border-radius: 15px;
      background-color: #f0f0f0;
      box-shadow: 12px 12px 24px rgba(163, 177, 198, 0.7), -12px -12px 24px rgba(255, 255, 255, 0.9);
      position: relative;
      cursor: pointer;
      transition: background-color 0.3s, box-shadow 0.3s;
    }

    .neumorphic-switch-inner {
      width: 50%;
      height: 100%;
      border-radius: 15px;
      background-color: #f0f0f0;
      position: absolute;
      top: 0;
      left: 0;
      transition: left 0.3s;
    }

    .neumorphic-switch.active {
      background-color: #4CAF50; /* Green color when switch is ON */
      box-shadow: inset 8px 8px 16px rgba(50, 107, 71, 0.5), inset -8px -8px 16px rgba(255, 255, 255, 0.9);
    }

    .neumorphic-switch.active .neumorphic-switch-inner {
      left: 50%;
    }
    .neumorphic-light-container {
      display: flex;
      align-items: center;
      margin: 20px;
    }

    .light-label {
      font-size: 16px;
      margin-right: 10px;
    }

    .neumorphic-light {
      margin-left: 32px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #f0f0f0;
      box-shadow: inset 5px 5px 10px rgba(163, 177, 198, 0.5), inset -5px -5px 10px rgba(255, 255, 255, 0.8);
      transition: box-shadow 0.3s;
    }

    .neumorphic-light.active {
      box-shadow: inset 8px 8px 16px rgba(50, 107, 71, 0.7), inset -8px -8px 16px rgba(255, 255, 255, 0.9);
    }
  </style>
</head>
<body>
  <div class="neumorphic-container">
    <div class="menu">
      <div class="menu-item">Home</div>
      <div class="menu-item">Settings</div>
      <div class="menu-item">Logs</div>
      <div class="menu-item">About</div>
    </div>    

    <div class="gauge-panel">
    <div class="gauge-container">
      <canvas id="gauge1"></canvas>
      <div class="gauge-label">ADC1</div>
    </div>

    <div class="gauge-container">
      <canvas id="gauge2"></canvas>
      <div class="gauge-label">ADC2</div>
    </div>

    <div class="gauge-container">
      <canvas id="gauge3"></canvas>
      <div class="gauge-label">ADC3</div>
    </div>

    <div class="gauge-container">
      <canvas id="gauge4"></canvas>
      <div class="gauge-label">ADC4</div>
    </div>

    </div>
	<div class="major-panel">
    <div class="control-panel">
    <div class="slider-container">
      <div class="setting-label">Analog 1</div>
      <div class="neumorphic-slider" id="slider1">
        <div class="slider-thumb" id="thumb1"></div>
      </div>
      <div class="setting-value" id="AO1">0</div>
    </div>

    <div class="slider-container">
      <div class="setting-label">Analog 2</div>
      <div class="neumorphic-slider" id="slider2">
        <div class="slider-thumb" id="thumb2"></div>
      </div>
      <div class="setting-value" id="AO2">0</div>
    </div>

    <div class="slider-container">
      <div class="setting-label">Analog 3</div>
      <div class="neumorphic-slider" id="slider3">
        <div class="slider-thumb" id="thumb3"></div>
      </div>
      <div class="setting-value" id="AO3">0</div>
    </div>

    <div class="slider-container">
      <div class="setting-label">Analog 4</div>
      <div class="neumorphic-slider" id="slider4">
        <div class="slider-thumb" id="thumb4"></div>
      </div>
      <div class="setting-value" id="AO4">0</div>
    </div>
    </div>
    <div class="control-panel">
    <div class="neumorphic-light-container">
    <div class="light-label">Digital Input 1</div>
    <div class="neumorphic-light" id="DI1"></div>
    </div>
    <div class="neumorphic-light-container">
    <div class="light-label">Digital Input 2</div>
    <div class="neumorphic-light" id="DI2"></div>
    </div>
    <div class="neumorphic-light-container">
    <div class="light-label">Digital Input 3</div>
    <div class="neumorphic-light" id="DI3"></div>
    </div>
    <div class="neumorphic-light-container">
    <div class="light-label">Digital Input 4</div>
    <div class="neumorphic-light" id="DI4"></div>
    </div>
	</div> 
    <div class="control-panel">
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 1</div>
    	<div class="neumorphic-switch" id="DO1" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div>
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 2</div>
    	<div class="neumorphic-switch" id="DO2" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div>      
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 3</div>
    	<div class="neumorphic-switch" id="DO3" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div>      
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 4</div>
    	<div class="neumorphic-switch" id="DO4" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div>      
  </div>
      <div class="control-panel">
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 5</div>
    	<div class="neumorphic-switch" id="DO5" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div>
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 6</div>
    	<div class="neumorphic-switch" id="DO6" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div>      
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 7</div>
    	<div class="neumorphic-switch" id="DO7" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div>      
      <div class="neumorphic-switch-container">
    	<div class="switch-text">Digital Output 8</div>
    	<div class="neumorphic-switch" id="DO8" onclick="toggleSwitch(this);setState(this)">
      	<div class="neumorphic-switch-inner"></div>
  		</div>
      </div> 
      </div>  
  </div>
  <script>
    // Sets the appearance of an element to active or inactive
    function setStatus(id, active) {
      const element = document.getElementById(id);
      if (Number(active)) {
        element.classList.add('active');
      } else {
        element.classList.remove('active');
      }
    }
  </script>  
  <script>
    function postAnalogValue(valueId) {
      switch(valueId){
          case "AO1":
            AO = 2;
            break;

          case "AO2":
            AO = 3;
            break;  

          case "AO3":
            AO = 4;
            break; 

          case "AO4":
            AO = 5;
            break; 
      }
      let value = (document.getElementById(valueId)).textContent;
      console.log(valueId, value);
      fetch('http://192.168.50.212/analogout', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
          },
          body: new URLSearchParams({
              'value': value,
              'port' : AO
          }),
          cache: 'no-store'
      });
    }     
    document.addEventListener("DOMContentLoaded", function() {
      function handleSliderInteraction(sliderId, thumbId, valueId, event) {
        var slider = document.getElementById(sliderId);
        var thumb = document.getElementById(thumbId);
        var settingValue = document.getElementById(valueId);

        var sliderRect = slider.getBoundingClientRect();
        var newPosition = event.clientX - sliderRect.left;
        var maxPosition = sliderRect.width;

        if (newPosition < 0) {
          newPosition = 0;
        } else if (newPosition > maxPosition) {
          newPosition = maxPosition;
        }

        thumb.style.left = newPosition + 'px';

        var maxValue = 3.3; // Depends on application as to what we show ADC MAX is 3.3

        // Calculate the setting value (1 to 100)
        var percentage = (newPosition / maxPosition) * 100;
        var value = Math.round(maxValue * percentage)/100;
        settingValue.textContent = value;
      }

      function addSliderListeners(sliderId, thumbId, valueId) {
        var thumb = document.getElementById(thumbId);

        thumb.addEventListener('mousedown', function(event) {
          document.addEventListener('mousemove', handleMouseMove);
          document.addEventListener('mouseup', handleMouseUp);

          function handleMouseMove(event) {
            handleSliderInteraction(sliderId, thumbId, valueId, event);
          }

          function handleMouseUp() {          
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
            postAnalogValue(valueId);  
          }
        });
      }

      // Add listeners for each slider
      addSliderListeners('slider1', 'thumb1', 'AO1');
      addSliderListeners('slider2', 'thumb2', 'AO2');
      addSliderListeners('slider3', 'thumb3', 'AO3');
      addSliderListeners('slider4', 'thumb4', 'AO4');
    });
  </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-gauges@2.1.7/gauge.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Create the first gauge
      var gauge1 = new RadialGauge({
        renderTo: 'gauge1',
        width: 200,
        height: 200,
        units: "Units",
        title: "Gauge 1",
        value: 0,
        minValue: 0,
        maxValue: 100
      }).draw();

      // Create the second gauge
      var gauge2 = new RadialGauge({
        renderTo: 'gauge2',
        width: 200,
        height: 200,
        units: "Units",
        title: "Gauge 2",
        value: 0,
        minValue: 0,
        maxValue: 100
      }).draw();

      // Create the third gauge
      var gauge3 = new RadialGauge({
        renderTo: 'gauge3',
        width: 200,
        height: 200,
        units: "Units",
        title: "Gauge 3",
        value: 0,
        minValue: 0,
        maxValue: 100
      }).draw();

      // Create the fourth gauge
      var gauge4 = new RadialGauge({
        renderTo: 'gauge4',
        width: 200,
        height: 200,
        units: "Units",
        title: "Gauge 4",
        value: 0,
        minValue: 0,
        maxValue: 100
      }).draw();
      onBodyLoad();
    });
  </script>
    <script>
    function toggleSwitch(switchElement) {
      switchElement.classList.toggle('active');
    }
  </script>
  <script>
    function isActive(element){
      return element.classList.contains("active");
    }
    function getTemperature() {
        fetch('http://192.168.50.212/temp')
            .then(res => res.json())
            .then(json => {
                console.log(json);
                var gauge = document.gauges.get('gauge1');
                gauge.value = json.temperature;
        }).catch(err => console.error(err));
    };
    function setTimeIntervalGauge() {
        const getTemperature = () => {
            fetch('http://192.168.50.212/temp')
                .then(res => res.json())
                .then(json => {
                    console.log(json);
                    var gauge = document.gauges.get('gauge1');
                    gauge.value = json.temperature;
            }).catch(err => console.error(err));                    
        };
        setInterval(getTemperature, 15000);
    };
/*    function getADC1() {
        fetch('http://192.168.50.212/adc/1')
            .then(res => res.json())
            .then(json => {
                console.log(json);
                var gauge = document.gauges.get('gauge2');
                gauge.value = json["1"]; 
        }).catch(err => console.error(err));
    };
    function getADC3() {
        fetch('http://192.168.50.212/adc/2')
            .then(res => res.json())
            .then(json => {
                console.log(json);
                var gauge = document.gauges.get('gauge3');
                gauge.value = json["2"]; 
        }).catch(err => console.error(err));
    };
    function getADC4() {
        fetch('http://192.168.50.212/adc/3')
            .then(res => res.json())
            .then(json => {
                console.log(json);
                var gauge = document.gauges.get('gauge4');
                gauge.value = json["3"]; 
        }).catch(err => console.error(err));
    }; */

    function setTimeIntervalADCs() {
      const getADC1 = () => {
      fetch('http://192.168.50.212/adc/1')
              .then(res => res.json())
              .then(json => {
                  console.log(json);
                  var gauge = document.gauges.get('gauge2');
                  gauge.value = json[1]; 
          }).catch(err => console.error(err));
      };
      setInterval(getADC1, 10000);
      const getADC2 = () => {
      fetch('http://192.168.50.212/adc/2')
              .then(res => res.json())
              .then(json => {
                  console.log(json);
                  var gauge = document.gauges.get('gauge3');
                  gauge.value = json[2]; 
          }).catch(err => console.error(err));
      };
      setInterval(getADC2, 10000);
      const getADC3 = () => {
      fetch('http://192.168.50.212/adc/3')
              .then(res => res.json())
              .then(json => {
                  console.log(json);
                  var gauge = document.gauges.get('gauge4');
                  gauge.value = json[3]; 
          }).catch(err => console.error(err));
      };
      setInterval(getADC3, 10000);
    };

    function reflectLEDstate(){
        var checkbox = document.getElementById('DO1');
        fetch('http://192.168.50.212/led')
            .then(res => res.json())
            .then(json => {
                console.log(json);
                console.log(json.led);
                setStatus('DO1', json.led);
        }).catch(err => console.error(err));
    };
    function setState(element){
      console.log(element);
        var state = Number(isActive(element));
        var DO;
        switch(element.id){
          case "DO1":
            DO = "led";
            gpio = null;
            break;

          case "DO2":
            DO = "gpio";
            gpio = 16;
            break;  

          case "DO3":
            DO = "gpio";
            gpio = 17;
            break; 

          case "DO4":
            DO = "gpio";
            gpio = 18;
            break; 
            
          case "DO5":
            DO = "gpio";
            gpio = 19;
            break;    
          
          case "DO6":
            DO = "gpio";
            gpio = 20;
            break; 
          
          case "DO7":
            DO = "gpio";
            gpio = 21;
            break; 
            
          case "DO8":
            DO = "gpio";
            gpio = 22;
            break;         
        }
        fetch('http://192.168.50.212/' + DO, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
            },
            body: new URLSearchParams({
                'value': state,
                'gpio' : gpio
            }),
            cache: 'no-store'
        })
    };
    function reflectGPIOstate(){
      fetch('http://192.168.50.212/gpioarray')
        .then(res => res.json())
        .then(json => {
          console.log(json);
          for(let i = 16; i < 23; i++){
            switch(i){
              case 16:
                setStatus('DO2', json[i]);
                break;
              case 17:
                setStatus('DO3', json[i]);
                break;
              case 18:
                setStatus('DO4', json[i]);
                break;
              case 19:
                setStatus('DO5', json[i]);
                break;
              case 20:
                setStatus('DO6', json[i]);
                break;
              case 21:
                setStatus('DO7', json[i]);
                break;
              case 22:
                setStatus('DO8', json[i]);
                break;
            }
          }
        }).catch(err => console.error(err));
    };

    function onBodyLoad(){
        //drawGauge();
        setTimeIntervalGauge();
        //setTimeIntervalADCs();
        //setTimeIntervalHistory();
        getTemperature();
        reflectLEDstate();
        reflectGPIOstate();
        //resize();
        //drawChart();
        //updateData(initialValues);
    }
  </script>
  <script>
    function setMsg(cls, text) {
				console.log(cls + ':' + text);
			}
    var ws;
    var retries;
    window.onload = function() {
      wsOpen();
    }
    function onMessage(evt) {
      console.log(evt);
      retries = 0;
      var dv = new DataView(evt.data);
      var val = dv.getUint16(0);
      if (val == 0xBEEF)
        console.log("LED switched on ");
      else if (val == 0xDEAD)
        console.log("LED switched off ");
      else
        console.log("Something else");
    }
    function wsOpen() {
      if (ws === undefined || ws.readyState != 0) {
        if (retries)
          setMsg("error", "WebSocket timeout, retrying..");
        else
          setMsg("info", "Opening WebSocket..");
        ws = new WebSocket("ws://" + location.host);
        ws.binaryType = 'arraybuffer';
        ws.onopen = function(evt) { retries = 0; setMsg("done", "WebSocket is open."); };
        ws.onerror = function(evt) { setMsg("error", "WebSocket error!"); };
        ws.onmessage = function(evt) { onMessage(evt); };
        wsOpenStream();
        retries = 0;
      }
    }
    function wsOpenStream() {
      var uri = "/stream"
      var ws = new WebSocket("ws://" + location.host + uri);
      ws.onmessage = function(evt) {
        console.log(evt.data);
        var stats = JSON.parse(evt.data);
        console.log(stats);
      };
    }
    function wsWrite(data) {
      if (ws.readyState == 3 || retries++ > 5)
        wsOpen();
      else if (ws.readyState == 1)
        ws.send(data);
    }
  </script>

</body>
</html>
